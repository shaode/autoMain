/**
 * Created by wb-xiongsongsong on 14-2-14.
 */
var fs = require('fs')
var path = require('path')

//入口
exports.start = function *() {
    this.moduleCache = {}
    return yield exports.read
}

//读取文件
exports.read = function *(next) {
    if (yield exports.isFile) {
        this.type = path.extname(this.fileName)
        return fs.createReadStream(this.fileName)
    } else {
        this.type = 'text/plain'
        return '\r\n/* ' + this.fileName + '404 Not Found */\r\n'
    }
}

//替换文件define
exports.replace = function *() {

}


//判断是否为一个文件
exports.isFile = function (callback) {
    fs.lstat(this.fileName, function (err, stat) {
        callback(null, stat && stat.isFile())
    })
}

